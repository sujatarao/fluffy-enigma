<!DOCTYPE html>
<html>
<head>
    <title>JSON to CSV Converter</title>
    <style>
        .container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        textarea { width: 100%; height: 300px; }
        .options { margin: 15px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div>
            <h3>JSON Input</h3>
            <textarea id="jsonInput" placeholder="Paste JSON here"></textarea>
            <input type="file" id="jsonFile" accept=".json">
            <div class="options">
                <label><input type="checkbox" id="headers"> Include Headers</label>
                <label><input type="checkbox" id="quotes"> Force Quotes</label>
            </div>
            <button onclick="convertJSON()">Convert to CSV</button>
        </div>
        <div>
            <h3>CSV Output</h3>
            <textarea id="csvOutput" readonly></textarea>
            <button onclick="downloadCSV()">Download CSV</button>
        </div>
    </div>

    <script>
        function convertJSON() {
            const jsonData = document.getElementById('jsonInput').value;
            const includeHeaders = document.getElementById('headers').checked;
            const forceQuotes = document.getElementById('quotes').checked;
            
            try {
                let data = parseJSONInput(jsonData);
                let csv = jsonToCSV(data, includeHeaders, forceQuotes);
                document.getElementById('csvOutput').value = csv;
            } catch (error) {
                alert(`Conversion Error: ${error.message}`);
            }
        }

        function parseJSONInput(json) {
            // Handle various JSON formats
            if (json.trim().startsWith('[')) {
                return JSON.parse(json);
            }
            
            // Handle JSON Lines format
            if (json.includes('\n')) {
                return json.split('\n').filter(line => line.trim()).map(JSON.parse);
            }
            
            // Handle single object with array property
            const obj = JSON.parse(json);
            if (obj && Object.values(obj)[0]?.length) {
                return Object.values(obj)[0];
            }
            
            return [obj];
        }

        function jsonToCSV(data, includeHeaders = true, forceQuotes = false) {
            const replacer = (key, value) => value ?? '';
            const header = includeHeaders ? 
                Object.keys(data[0]).join(',') + '\n' : '';
            
            const csvRows = data.map(row => {
                const values = Object.values(row).map(value => {
                    const strValue = typeof value === 'object' ? 
                        JSON.stringify(value) : String(value);
                    return forceQuotes ? `"${strValue}"` : strValue;
                });
                return values.join(',');
            });
            
            return header + csvRows.join('\n');
        }

        // File handling and download functions
        document.getElementById('jsonFile').addEventListener('change', handleFile);
        function handleFile(e) { /* File read implementation */ }
        function downloadCSV() { /* CSV download implementation */ }
    </script>
</body>
</html>
