<!DOCTYPE html>
<html>
<head>
    <title>JSON to CSV Converter</title>
    <style>
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .converter-box { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        textarea { width: 100%; height: 300px; padding: 10px; border: 1px solid #ccc; }
        .file-input { margin: 15px 0; }
        .options { background: #f5f5f5; padding: 15px; margin: 15px 0; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <h1>JSON to CSV Converter</h1>
        <div class="converter-box">
            <div class="input-section">
                <h3>JSON Input</h3>
                <textarea id="jsonInput" placeholder='Paste JSON here or upload file'></textarea>
                <div class="file-input">
                    <input type="file" id="jsonFile" accept=".json">
                    <button onclick="clearInput()">Clear</button>
                </div>
                <div class="options">
                    <label><input type="checkbox" id="headers" checked> Include Headers</label>
                    <label><input type="checkbox" id="quotes"> Force Quotes</label>
                    <label><input type="checkbox" id="flatten"> Flatten Nested Objects</label>
                </div>
                <button onclick="convertJSON()">Convert to CSV</button>
            </div>
            
            <div class="output-section">
                <h3>CSV Output</h3>
                <textarea id="csvOutput" readonly></textarea>
                <button onclick="downloadCSV()">Download CSV</button>
            </div>
        </div>
    </div>

<script>
function convertJSON() {
    const jsonData = document.getElementById('jsonInput').value;
    const options = {
        headers: document.getElementById('headers').checked,
        quotes: document.getElementById('quotes').checked,
        flatten: document.getElementById('flatten').checked
    };

    try {
        const parsedData = parseJSON(jsonData);
        const csvData = jsonToCSV(parsedData, options);
        document.getElementById('csvOutput').value = csvData;
    } catch (error) {
        alert(`Error: ${error.message}`);
    }
}

function parseJSON(jsonString) {
    try {
        // Handle JSON Lines format
        if (jsonString.includes('\n')) {
            return jsonString.split('\n')
                .filter(line => line.trim())
                .map(line => JSON.parse(line));
        }
        return JSON.parse(jsonString);
    } catch (e) {
        throw new Error('Invalid JSON format');
    }
}

function jsonToCSV(data, options) {
    if (!Array.isArray(data)) data = [data];
    
    const flattenObject = (obj, prefix = '') => {
        return Object.keys(obj).reduce((acc, key) => {
            const pre = prefix ? `${prefix}.` : '';
            if (typeof obj[key] === 'object' && obj[key] !== null && options.flatten) {
                Object.assign(acc, flattenObject(obj[key], pre + key));
            } else {
                acc[pre + key] = obj[key];
            }
            return acc;
        }, {});
    };

    const processedData = options.flatten ? data.map(flattenObject) : data;
    const headers = [...new Set(processedData.flatMap(Object.keys))];
    
    const escapeCSV = (value) => {
        if (typeof value === 'string') {
            const needsQuotes = /[",\n]/.test(value);
            value = value.replace(/"/g, '""');
            return needsQuotes || options.quotes ? `"${value}"` : value;
        }
        return value;
    };

    const csvRows = [];
    if (options.headers) csvRows.push(headers.join(','));
    
    processedData.forEach(item => {
        const row = headers.map(header => 
            escapeCSV(item[header] ?? '')
        );
        csvRows.push(row.join(','));
    });

    return csvRows.join('\n');
}

// File handling
document.getElementById('jsonFile').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = function() {
        document.getElementById('jsonInput').value = reader.result;
    };
    reader.readAsText(file);
});

function downloadCSV() {
    const csv = document.getElementById('csvOutput').value;
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'converted.csv';
    a.click();
    window.URL.revokeObjectURL(url);
}

function clearInput() {
    document.getElementById('jsonInput').value = '';
    document.getElementById('csvOutput').value = '';
}
</script>
</body>
</html>
